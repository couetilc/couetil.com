---
import BaseLayout from '../layouts/BaseLayout.astro';
import '../styles/home.css';
---

<BaseLayout title="Yo.">

  <section id="content">
    <picture id="background">
      <source media="(min-width: 2050px)"
              srcset="/sat_R20m_output80_nosharp.webp">
      <source media="(min-width: 2050px)"
              type="image/jpeg"
              srcset="/sat_R20m_output80_nosharp.jpg">
      <source media="(min-width: 900px) and (max-width: 2049px) and (min-resolution: 2dppx)"
              type="image/webp"
              srcset="/sat_R20m_output80_nosharp.webp">
      <source media="(min-width: 900px) and (max-width: 2049px)"
              type="image/webp"
              srcset="/sat_R60m_output80_nosharp.webp">
      <source media="(min-width: 900px) and (max-width: 2049px) and (min-resolution: 2dppx)"
              type="image/jpeg"
              srcset="/sat_R20m_output80_nosharp.jpg">
      <source media="(min-width: 900px) and (max-width: 2049px)"
              type="image/jpeg"
              srcset="/sat_R60m_output80_nosharp.jpg">
      <source media="(min-width: 500px) and (max-width: 899px) and (min-resolution: 2dppx)"
              type="image/webp"
              srcset="/sat_R60m_output80_nosharp.webp">
      <source media="(min-width: 500px) and (max-width: 899px)"
              type="image/webp"
              srcset="/sat_R60m_output80_nosharp_1200.webp">
      <source media="(min-width: 500px) and (max-width: 899px) and (min-resolution: 2dppx)"
              type="image/jpeg"
              srcset="/sat_R60m_output80_nosharp.jpg">
      <source media="(min-width: 500px) and (max-width: 899px)"
              type="image/jpeg"
              srcset="/sat_R60m_output80_nosharp_1200.jpg">
      <source media="(min-resolution: 2dppx)"
              type="image/webp"
              srcset="/sat_R60m_output80_nosharp.webp">
      <source type="image/webp"
              srcset="/sat_R60m_output80_nosharp_700.webp">
      <source media="(min-resolution: 2dppx)"
              type="image/jpg"
              srcset="/sat_R60m_output80_nosharp.jpg">
      <img src="/sat_R60m_output80_nosharp_700.jpg" alt="a satellite image in the background">
    </picture>
    <div id="cloud">
      <img id="scribble" src="/scribble.svg" alt="a cloud as vector art behind the header">
      <header>
        <h1>
          Connor Couetil
        </h1>
        <nav>
          <span class="nav-item">
            <a href="/portfolio/">
              Portfolio
            </a>
            <svg class="highlight" style="fill: var(--highlight-color, rgba(79, 163, 217, 0.3));" viewBox="0 0 70 10" xmlns="http://www.w3.org/2000/svg"> <path d="M 6.385552,4.63936 C 11.480969,4.181 16.60105,4.05285 21.712758,3.90865 32.7606,3.73846 43.81028,3.79264 54.85913,3.73137 c 0,0 -4.70209,-3.39869 -4.70209,-3.39869 v 0 C 46.62391,0.48992 44.46506,0.59986 40.86904,0.6987 33.02731,0.91426 25.18129,0.87207 17.338653,0.7307 11.556415,0.57934 5.769901,0.42675 0,0 Z" pathLength="200" /></svg>
          </span>
          <span class="nav-item">
            <a href="/resume/">
              Resume
            </a>
            <svg class="highlight" style="fill: var(--highlight-color, rgba(122, 169, 116, 0.3));" viewBox="0 0 70 10" xmlns="http://www.w3.org/2000/svg"> <path d="M 6.385552,4.63936 C 11.480969,4.181 16.60105,4.05285 21.712758,3.90865 32.7606,3.73846 43.81028,3.79264 54.85913,3.73137 c 0,0 -4.70209,-3.39869 -4.70209,-3.39869 v 0 C 46.62391,0.48992 44.46506,0.59986 40.86904,0.6987 33.02731,0.91426 25.18129,0.87207 17.338653,0.7307 11.556415,0.57934 5.769901,0.42675 0,0 Z" pathLength="200" /></svg>
          </span>
          </span>
          <span class="nav-item">
            <a href="https://github.com/couetilc">
              GitHub
            </a>
            <svg class="highlight" style="fill: var(--highlight-color, rgba(242, 92, 84, 0.3));" viewBox="0 0 70 10" xmlns="http://www.w3.org/2000/svg"> <path d="M 6.385552,4.63936 C 11.480969,4.181 16.60105,4.05285 21.712758,3.90865 32.7606,3.73846 43.81028,3.79264 54.85913,3.73137 c 0,0 -4.70209,-3.39869 -4.70209,-3.39869 v 0 C 46.62391,0.48992 44.46506,0.59986 40.86904,0.6987 33.02731,0.91426 25.18129,0.87207 17.338653,0.7307 11.556415,0.57934 5.769901,0.42675 0,0 Z" pathLength="200" /></svg>
          </span>
          <span class="nav-item">
            <a href="https://linkedin.com/in/connorcouetil">
              LinkedIn
            </a>
            <svg class="highlight" style="fill: var(--highlight-color, rgba(214, 168, 79, 0.3));" viewBox="0 0 70 10" xmlns="http://www.w3.org/2000/svg"> <path d="M 6.385552,4.63936 C 11.480969,4.181 16.60105,4.05285 21.712758,3.90865 32.7606,3.73846 43.81028,3.79264 54.85913,3.73137 c 0,0 -4.70209,-3.39869 -4.70209,-3.39869 v 0 C 46.62391,0.48992 44.46506,0.59986 40.86904,0.6987 33.02731,0.91426 25.18129,0.87207 17.338653,0.7307 11.556415,0.57934 5.769901,0.42675 0,0 Z" pathLength="200" /></svg>
          </span>
          <span class="nav-item">
            <a href="/about/">
              About
            </a>
            <svg class="highlight" style="fill: var(--highlight-color, rgba(162, 103, 172, 0.3));" viewBox="0 0 70 10" xmlns="http://www.w3.org/2000/svg"> <path d="M 6.385552,4.63936 C 11.480969,4.181 16.60105,4.05285 21.712758,3.90865 32.7606,3.73846 43.81028,3.79264 54.85913,3.73137 c 0,0 -4.70209,-3.39869 -4.70209,-3.39869 v 0 C 46.62391,0.48992 44.46506,0.59986 40.86904,0.6987 33.02731,0.91426 25.18129,0.87207 17.338653,0.7307 11.556415,0.57934 5.769901,0.42675 0,0 Z" pathLength="200" /></svg>

          </span>
        </nav>
      </header>
    </div>
  </section>

  <script>
    // link highlight animation

    function throttle(fn: (...args: any[]) => void, interval = 200) {
      let lastTime = 0;
      return function (...args: any[]) {
        const now = Date.now();
        if (now - lastTime >= interval) {
          lastTime = now;
          fn.apply(null, args);
        }
      };
    }
    function nextColor() {
      const colors = [
        'rgba(79, 163, 217, 0.3)',
        'rgba(122, 169, 116, 0.3)',
        'rgba(242, 92, 84, 0.3)',
        'rgba(214, 168, 79, 0.3)',
        'rgba(162, 103, 172, 0.3)',
      ];
      let i = 0;
      return () => {
        const c = colors[i];
        i = (i + 1) % colors.length;
        return c;
      }
    }
    (function () {
      const next = nextColor();
      document.querySelector('nav')!
        .style.setProperty('--highlight-color', next());
      const navLinks = document.querySelectorAll('.nav-item a');
      navLinks.forEach(item => {
        item.addEventListener('mouseenter', throttle(() => {
          document.querySelector('nav')!
            .style.setProperty('--highlight-color', next());
        }));
      })
    })();
  </script>

  <script>
    // satellite image animation with velocity-based altitude

    // Animation state
    let mouseTarget = { x: 0, y: 0 };
    let mouseCurrent = { x: 0, y: 0 };
    let lastPosition = { x: 0, y: 0, time: 0 };
    let velocity = 0;
    let currentScale = 1.6;  // Start at ground level (zoomed in)
    let targetScale = 1.6;
    let currentRotation = { x: 0, y: 0 };
    let targetRotation = { x: 0, y: 0 };

    // Animation parameters (tunable)
    const BASE_SCALE = 1.6;           // Maximum scale when stationary (ground level) - increased for 3D rotation
    const MIN_SCALE = 1.1;            // Minimum scale at high velocity (high altitude) - increased for 3D rotation
    const VELOCITY_TO_SCALE = 0.5;    // How much velocity affects scale (lower = more gradual)
    const POSITION_DAMPING = 0.08;    // Lower = smoother position (0.05-0.15)
    const SCALE_DAMPING = 0.04;       // Lower = smoother scale changes (more gradual)
    const VELOCITY_SMOOTHING = 0.15;  // How quickly velocity adjusts (lower = smoother acceleration)
    const VELOCITY_DECAY = 0.85;      // How quickly velocity decays when not moving
    const PARALLAX_STRENGTH = 80;     // Maximum pixel offset from center
    const MAX_ROTATION = 8;           // Maximum rotation angle in degrees (tilt/banking effect)
    const ROTATION_DAMPING = 0.06;    // Lower = smoother rotation changes

    // Get the background image element
    const bgImg = document.querySelector('#background img') as HTMLElement;
    const bgPicture = document.querySelector('#background') as HTMLElement;

    // Track mouse position
    document.addEventListener('mousemove', (event: MouseEvent) => {
      mouseTarget.x = event.clientX;
      mouseTarget.y = event.clientY;
    });

    // Animation loop
    function animate() {
      const now = performance.now();
      const width = window.innerWidth;
      const height = window.innerHeight;
      const centerX = width / 2;
      const centerY = height / 2;

      // Smoothly interpolate current position toward target
      mouseCurrent.x += (mouseTarget.x - mouseCurrent.x) * POSITION_DAMPING;
      mouseCurrent.y += (mouseTarget.y - mouseCurrent.y) * POSITION_DAMPING;

      // Calculate velocity
      if (lastPosition.time > 0) {
        const deltaTime = now - lastPosition.time;
        const deltaX = mouseCurrent.x - lastPosition.x;
        const deltaY = mouseCurrent.y - lastPosition.y;
        const distance = Math.sqrt(deltaX * deltaX + deltaY * deltaY);
        const instantVelocity = deltaTime > 0 ? distance / deltaTime : 0;

        // Smooth velocity with acceleration factor (gradual changes)
        velocity += (instantVelocity - velocity) * VELOCITY_SMOOTHING;

        // Apply decay when slowing down
        if (instantVelocity < velocity) {
          velocity *= VELOCITY_DECAY;
        }
      }

      // Update last position
      lastPosition = { x: mouseCurrent.x, y: mouseCurrent.y, time: now };

      // Map velocity to scale (altitude) - INVERTED: high velocity = zoom OUT (high altitude)
      const velocityScale = Math.min(velocity * VELOCITY_TO_SCALE, BASE_SCALE - MIN_SCALE);
      targetScale = BASE_SCALE - velocityScale;  // Subtract to zoom out when moving fast
      currentScale += (targetScale - currentScale) * SCALE_DAMPING;

      // Calculate 3D rotation based on mouse position (banking/tilt effect)
      const normX = (mouseCurrent.x - centerX) / (width / 2);
      const normY = (mouseCurrent.y - centerY) / (height / 2);

      targetRotation.y = normX * MAX_ROTATION;     // Horizontal movement = Y-axis rotation (yaw)
      targetRotation.x = -normY * MAX_ROTATION;    // Vertical movement = X-axis rotation (pitch, inverted)

      // Smoothly interpolate rotation
      currentRotation.x += (targetRotation.x - currentRotation.x) * ROTATION_DAMPING;
      currentRotation.y += (targetRotation.y - currentRotation.y) * ROTATION_DAMPING;

      // Calculate parallax offset (inverted direction)
      const offsetX = -((mouseCurrent.x - centerX) / centerX) * PARALLAX_STRENGTH;
      const offsetY = -((mouseCurrent.y - centerY) / centerY) * PARALLAX_STRENGTH;

      // Edge containment: calculate safe translation bounds
      if (bgImg && bgPicture) {
        const imgRect = bgImg.getBoundingClientRect();
        const imgWidth = imgRect.width / currentScale;  // Original size before transform
        const imgHeight = imgRect.height / currentScale;

        const maxTranslateX = Math.max(0, (imgWidth * currentScale - width) / 2);
        const maxTranslateY = Math.max(0, (imgHeight * currentScale - height) / 2);

        // Clamp translations to safe bounds
        const clampedX = Math.max(-maxTranslateX, Math.min(maxTranslateX, offsetX));
        const clampedY = Math.max(-maxTranslateY, Math.min(maxTranslateY, offsetY));

        // Apply 3D transform with rotation, translation, and scale
        bgImg.style.transform = `
          rotateX(${currentRotation.x}deg)
          rotateY(${currentRotation.y}deg)
          translate(${clampedX}px, ${clampedY}px)
          scale(${currentScale})
        `.replace(/\s+/g, ' ').trim();
      }

      requestAnimationFrame(animate);
    }

    // Start animation loop
    requestAnimationFrame(animate);
  </script>
</BaseLayout>
